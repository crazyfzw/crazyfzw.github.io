<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"crazyfzw.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一、概述集群的搭建可以分为以节点准备、节点握手、分配槽三个步骤。 节点准备Redis集群一般由多个节点组成，节点数量至少为6个才能保证组成完整高可用的集群。每个节点需要开启配置 cluster-enabled yes，让 Redis 运行在集群模式下。建议为集群内所有节点统一目录，一般划分三个目录：conf、data、log，分别存放配置、数据和日志相关文件。把6个节点配置统一放在conf目录下。">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 开发与运维 4：Redis 集群的搭建与运维">
<meta property="og:url" content="https://crazyfzw.github.io/2018/08/24/redis-cluster-setup-and-operation/index.html">
<meta property="og:site_name" content="Crazyfzw&#39;s blog">
<meta property="og:description" content="一、概述集群的搭建可以分为以节点准备、节点握手、分配槽三个步骤。 节点准备Redis集群一般由多个节点组成，节点数量至少为6个才能保证组成完整高可用的集群。每个节点需要开启配置 cluster-enabled yes，让 Redis 运行在集群模式下。建议为集群内所有节点统一目录，一般划分三个目录：conf、data、log，分别存放配置、数据和日志相关文件。把6个节点配置统一放在conf目录下。">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082404.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082401.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082402.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082403.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082405.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082406.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082407.png">
<meta property="og:image" content="https://crazyfzw.github.io/images/2018082408.png">
<meta property="article:published_time" content="2018-08-24T12:34:01.000Z">
<meta property="article:modified_time" content="2020-12-06T16:28:21.784Z">
<meta property="article:author" content="crazyfzw">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="Redis cluster">
<meta property="article:tag" content="Redis集群搭建">
<meta property="article:tag" content="redis-trib.rb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://crazyfzw.github.io/images/2018082404.png">

<link rel="canonical" href="https://crazyfzw.github.io/2018/08/24/redis-cluster-setup-and-operation/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Redis 开发与运维 4：Redis 集群的搭建与运维 | Crazyfzw's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Crazyfzw's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Crazyfzw's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Return to base, step by step.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://crazyfzw.github.io/2018/08/24/redis-cluster-setup-and-operation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="crazyfzw">
      <meta itemprop="description" content="做个有趣的技术人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Crazyfzw's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis 开发与运维 4：Redis 集群的搭建与运维
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-24 20:34:01" itemprop="dateCreated datePublished" datetime="2018-08-24T20:34:01+08:00">2018-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-07 00:28:21" itemprop="dateModified" datetime="2020-12-07T00:28:21+08:00">2020-12-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/08/24/redis-cluster-setup-and-operation/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/08/24/redis-cluster-setup-and-operation/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>集群的搭建可以分为以节点准备、节点握手、分配槽三个步骤。</p>
<h3 id="节点准备"><a href="#节点准备" class="headerlink" title="节点准备"></a>节点准备</h3><p>Redis集群一般由多个节点组成，节点数量至少为6个才能保证组成完整高可用的集群。每个节点需要开启配置 cluster-enabled yes，让 Redis 运行在集群模式下。建议为集群内所有节点统一目录，一般划分三个目录：conf、data、log，分别存放配置、数据和日志相关文件。把6个节点配置统一放在conf目录下。</p>
<a id="more"></a>


<h3 id="节点握手"><a href="#节点握手" class="headerlink" title="节点握手"></a>节点握手</h3><p>节点握手是指一批运行在集群模式下的节点通过 Gossip 协议彼此通信，达到感知对方的过程。<br>我们只需要在集群内任意节点上执行 cluster meet 命令加入新节点，握手状态会通过消息在集群内传播，这样其他节点会自动发现新节点并发起握手.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; cluster meet 127.0.0.1 6381</span><br></pre></td></tr></table></figure>

<h3 id="分配槽"><a href="#分配槽" class="headerlink" title="分配槽"></a>分配槽</h3><p>Redis集群把所有的数据映射到16384个槽中。每个 key 会映射为一个固定的槽，只有当节点分配了槽，才能响应和这些槽关联的键命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379 cluster addslots &#123;0...5641&#125;</span><br></pre></td></tr></table></figure>


<h2 id="二、用-redis-trib-rb-搭建集群"><a href="#二、用-redis-trib-rb-搭建集群" class="headerlink" title="二、用 redis-trib.rb 搭建集群"></a>二、用 redis-trib.rb 搭建集群</h2><p>虽然手动搭建集群可以让我们了解集群建立的流程和细节，单当节点多时，手动搭建比较繁琐，并且容易出错，所以生产环境推荐使用 redis-trib.rb 集群管理工具进行搭建。 redis-trib.rb 提供了集群的创建、检查、修复、均衡等命令行工具，输入 redis-trib.rb 命令可以查看到具体的参数用法。</p>
<p>这里用3台机器，每个机器上安装4个节点，总共12个节点，按1主1从组成集群。</p>
<table>
<thead>
<tr>
<th align="center">服务器</th>
<th align="center">节点实例端口</th>
</tr>
</thead>
<tbody><tr>
<td align="center">10.2.8.94</td>
<td align="center">7000,7001,7002,7003</td>
</tr>
<tr>
<td align="center">10.2.8.95</td>
<td align="center">7004,7005,7006,7007</td>
</tr>
<tr>
<td align="center">10.2.8.96</td>
<td align="center">7008,7009,7010,7011</td>
</tr>
</tbody></table>
<p><strong>准备节点</strong></p>
<p>下面以一台服务器为例，安装4个节点，其余2台机器也采用同样的方式进行安装。</p>
<h3 id="安装目录"><a href="#安装目录" class="headerlink" title="安装目录"></a>安装目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;</span><br></pre></td></tr></table></figure>


<h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#service iptables stop #关闭防火墙</span><br><span class="line">#service iptables status #查看状态</span><br></pre></td></tr></table></figure>

<h3 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line"># wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.2.3.tar.gz #下载安装包</span><br><span class="line"># tar -xf redis-3.2.3.tar.gz #解压安装包</span><br><span class="line"># ln -s redis-3.2.3 redis #建立软链接,方便以后升级维护</span><br><span class="line"># cd redis</span><br><span class="line"># make &amp;&amp; make install </span><br><span class="line"># cd src</span><br><span class="line"># .&#x2F;redis-cli -v #验证安装是否成功</span><br><span class="line"># export &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;src:$PATH&quot; #设置环境变量</span><br></pre></td></tr></table></figure>
<p>这一步可以参考我的上一篇博客：<a href="https://crazyfzw.github.io/2018/08/10/Redis%20%E5%BC%80%E5%8F%91%E4%B8%8E%E8%BF%90%E7%BB%B4%202%EF%BC%9ARedis-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A-Redis-shell-%E7%9A%84%E4%BD%BF%E7%94%A8/#more">Redis环境搭建及Redis shell的使用</a></p>
<h3 id="安装-redis-trib-rb-工具"><a href="#安装-redis-trib-rb-工具" class="headerlink" title="安装 redis-trib.rb 工具"></a>安装 redis-trib.rb 工具</h3><p>redis-trib.rb 是采用Ruby实现的Redis集群管理工具。内部通过Cluster相关命令帮我们简化集群创建、检查、槽迁移和均衡等常见运维操作，使用前需要安装Ruby环境。注意由于我们用redis-trib.rb 在一台服务器上就可以操作整个集群了，所以只需要挑选一台服务器安装既可，不需要每天服务器都安装。</p>
<h4 id="1）安装Ruby"><a href="#1）安装Ruby" class="headerlink" title="1）安装Ruby"></a>1）安装Ruby</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 local]# wget https:&#x2F;&#x2F;cache.ruby-lang.org&#x2F;pub&#x2F;ruby&#x2F;2.3&#x2F;ruby-2.3.1.tar.gz</span><br><span class="line">[root@gdyt-wbredis01 local]# tar -xf ruby-2.3.1.tar.gz</span><br><span class="line">[root@gdyt-wbredis01 local]# ln -s ruby-2.3.1 ruby</span><br><span class="line">[root@gdyt-wbredis01 local]# cd ruby</span><br><span class="line">[root@gdyt-wbredis01 ruby]# .&#x2F;configure</span><br><span class="line">[root@gdyt-wbredis01 ruby]# make &amp;&amp; make install</span><br><span class="line">[root@gdyt-wbredis01 ruby]# .&#x2F;ruby  -v</span><br><span class="line">ruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]</span><br><span class="line"></span><br><span class="line">[root@gdyt-wbredis01 ruby]# export &quot;PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;redis&#x2F;src:&#x2F;usr&#x2F;local&#x2F;ruby:&#x2F;usr&#x2F;local&#x2F;ruby&#x2F;bin:$PATH&quot; #设置环境变量</span><br></pre></td></tr></table></figure>

<h4 id="2）安装-rubygem-redis-依赖。"><a href="#2）安装-rubygem-redis-依赖。" class="headerlink" title="2）安装 rubygem redis 依赖。"></a>2）安装 rubygem redis 依赖。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 ruby]# gem sources --add https:&#x2F;&#x2F;ruby.taobao.org&#x2F; --remove https:&#x2F;&#x2F;rubygems.org&#x2F;</span><br><span class="line">[root@gdyt-wbredis01 bin]#  gem sources -l</span><br><span class="line">https:&#x2F;&#x2F;ruby.taobao.org&#x2F;</span><br><span class="line">[root@gdyt-wbredis01 bin]# gem install redis</span><br></pre></td></tr></table></figure>
<p>安装好后执行 redis-trib.rb 命令确认是否安装成功。</p>
<p><img src="/images/2018082404.png" alt=""></p>
<h3 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h3><h4 id="1）创建集群配置文件夹"><a href="#1）创建集群配置文件夹" class="headerlink" title="1）创建集群配置文件夹"></a>1）创建集群配置文件夹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#mkdir &#x2F;etc&#x2F;redis&#x2F;redis_cluster -p</span><br></pre></td></tr></table></figure>

<h4 id="2）创建多个实例目录"><a href="#2）创建多个实例目录" class="headerlink" title="2）创建多个实例目录"></a>2）创建多个实例目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 redis_cluster]# mkdir 7000 7001 7002 7003</span><br><span class="line">[root@gdyt-wbredis01 redis_cluster]# ls -l</span><br><span class="line">总用量 16</span><br><span class="line">drwxr-xr-x 2 root root 4096 8月  16 09:59 7000</span><br><span class="line">drwxr-xr-x 2 root root 4096 8月  16 09:59 7001</span><br><span class="line">drwxr-xr-x 2 root root 4096 8月  16 09:59 7002</span><br><span class="line">drwxr-xr-x 2 root root 4096 8月  16 09:59 7003</span><br></pre></td></tr></table></figure>

<h4 id="3）-配置文件"><a href="#3）-配置文件" class="headerlink" title="3） 配置文件"></a>3） 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis.conf 7000&#x2F;redis.conf</span><br><span class="line">cp &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis.conf 7001&#x2F;redis.conf</span><br><span class="line">cp &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis.conf 7002&#x2F;redis.conf</span><br><span class="line">cp &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis.conf 7003&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bind 10.2.8.94 #绑定本机IP</span><br><span class="line">daemonize yes #后台运行</span><br><span class="line">pidfile  &#x2F;var&#x2F;run&#x2F;redis_7000.pid #PID文件</span><br><span class="line">port  7000 #监听端口</span><br><span class="line">cluster-enabled yes #开启集群</span><br><span class="line">cluster-config-file  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7000&#x2F;nodes-7000.conf #实例节点配置</span><br><span class="line">cluster-node-timeout 5000 #集群通信超时</span><br><span class="line">appendonly yes #AOF日志开启写</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line">cluster-require-full-coverage no #设置为no主节点故障时，不会影响其他节点的可用性</span><br></pre></td></tr></table></figure>


<h4 id="4）用配置文件启动各个节点"><a href="#4）用配置文件启动各个节点" class="headerlink" title="4）用配置文件启动各个节点"></a>4）用配置文件启动各个节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7000&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7001&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7002&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7003&#x2F;redis.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis02 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7004&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis02 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7005&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis02 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7006&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis02 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7007&#x2F;redis.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis03 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7008&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis03 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7009&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis03 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7010&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis03 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7011&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

<h4 id="5）配置集群-At-least-6-nodes-are-required-至少需要6个节点"><a href="#5）配置集群-At-least-6-nodes-are-required-至少需要6个节点" class="headerlink" title="5）配置集群(At least 6 nodes are required., 至少需要6个节点)"></a>5）配置集群(At least 6 nodes are required., 至少需要6个节点)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 ~]#redis-trib.rb create  --replicas  1  10.2.8.94:7000  10.2.8.94:7001  10.2.8.94:7002  10.2.8.94:7003  10.2.8.95:7004  10.2.8.95:7005 10.2.8.95:7006 10.2.8.95:7007 10.2.8.96:7008 10.2.8.96:7009 10.2.8.96:7010 10.2.8.96:7011</span><br></pre></td></tr></table></figure>


<p><strong>其中 –replicas 后面的 数字 表示给每个主节点配备几个从节点，这里需要特别注意的是，redis-trib.rb会重新排序列表顺序，来确定主从角色，尽可能的保证主从节点不分配在统一机器下。</strong></p>
<p><img src="/images/2018082401.png" alt=""></p>
<p>可以用 redis-trib.rb 的 info 或 check 来查看或检查集群的信息</p>
<p><img src="/images/2018082402.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 ~]# redis-trib.rb check 10.2.8.94:7001</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 10.2.8.94:7001)</span><br><span class="line">S: 84923706efb5d77511707b8f74abd3f57d3c26a9 10.2.8.94:7001</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates b5819808aa06db5ada355e111dda2a129aa3597c</span><br><span class="line">M: 1c864de9ba655958f0ceae2363acfc298d5039e8 10.2.8.96:7009</span><br><span class="line">   slots:13653-16383 (2731 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 07a32cf512dd04a9ead49cc7dc1ce6c087c799a5 10.2.8.94:7002</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 8c141a332d7bc488ac9236a778791f6b80aec1e3</span><br><span class="line">M: 8c141a332d7bc488ac9236a778791f6b80aec1e3 10.2.8.95:7004</span><br><span class="line">   slots:2731-5460 (2730 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 4eeb5d5207f599a7469dd8f031517ae7b69be126 10.2.8.94:7003</span><br><span class="line">   slots:5461-8191 (2731 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: e2d75e2d9375255e6d0c877208ff0e85fa4fd7d3 10.2.8.95:7006</span><br><span class="line">   slots:0-2730 (2731 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 107fc0afc81a5c1c3a72e72dc0a9832bb543ed13 10.2.8.96:7011</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 24f3d8feb7c16ac2b5fa72cd60e9f34dd04b11ed</span><br><span class="line">S: 4ba0b34eb289ac7d5222e0e1f55a461ebdc97d66 10.2.8.94:7000</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates e2d75e2d9375255e6d0c877208ff0e85fa4fd7d3</span><br><span class="line">M: 24f3d8feb7c16ac2b5fa72cd60e9f34dd04b11ed 10.2.8.95:7005</span><br><span class="line">   slots:10923-13652 (2730 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: e33c091a22ba1963ad6f17ee4fb8b11b405e553d 10.2.8.96:7008</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 4eeb5d5207f599a7469dd8f031517ae7b69be126</span><br><span class="line">S: 306ac97503a76b662fe5a6515f699e8c47f9f219 10.2.8.95:7007</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1c864de9ba655958f0ceae2363acfc298d5039e8</span><br><span class="line">M: b5819808aa06db5ada355e111dda2a129aa3597c 10.2.8.96:7010</span><br><span class="line">   slots:8192-10922 (2731 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check for open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>



<h4 id="6）验证"><a href="#6）验证" class="headerlink" title="6）验证"></a>6）验证</h4><p>通过 -c 参数进入集群模式进行验证后， 在任意一台服务器连接任意实例端口操作数据，将会自动在片区进行操作。</p>
<p><img src="/images/2018082403.png" alt=""></p>
<p>至此，整个集群已经配置完成了。</p>
<h2 id="三、设置密码"><a href="#三、设置密码" class="headerlink" title="三、设置密码"></a>三、设置密码</h2><p>vi /etc/redis/redis_cluster/7000/redis.conf</p>
<p>在文件末尾加入。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">masterauth &quot;crazyfzw&quot;</span><br><span class="line">requirepass &quot;crazyfzw&quot;</span><br></pre></td></tr></table></figure>

<p>按照同样的方法给集群的所有节点设置相同的密码（一定要相同），然后通过配置文件重新启动所有服务就可以了。</p>
<p><strong>设置密码后的注意事项：</strong></p>
<p>需要注意的是设置密码后，执行 redis-cli 连接的时候需要一定要指定密码，否则无法执行任何命令，会报错(error) NOAUTH Authentication required.，如下图：</p>
<p><img src="/images/2018082405.png" alt=""></p>
<p>正确的操作应该这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -h 10.2.8.94 -p 7000 -a yourpass</span><br></pre></td></tr></table></figure>

<p>*<em>设置密码后 redis-trib.rb 工具将会无法使用，执行相关命令会报错： *</em></p>
<p><img src="/images/2018082406.png" alt=""></p>
<p>解决办法：修改 client.rb 的中的密码。（tip: 可以通过find命令找到文件所在的目录）</p>
<p><img src="/images/2018082407.png" alt=""></p>
<h2 id="四、优化系统"><a href="#四、优化系统" class="headerlink" title="四、优化系统"></a>四、优化系统</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">#TCP监听队列值</span><br><span class="line">net.core.somaxconn &#x3D; 2048</span><br><span class="line">#内存分配策略，选择1 表示内核允许分配所有的物理内存，而不管当前的内存状态如何；</span><br><span class="line">#默认0 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程</span><br><span class="line">vm.overcommit_memory &#x3D; 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用配置生效</span><br><span class="line"># sysctl -p</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#Redis不使用透明大页</span><br><span class="line">#加入开机启动</span><br><span class="line"># vi  &#x2F;etc&#x2F;rc.local</span><br><span class="line">echo never &gt; &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled</span><br><span class="line">&#96;&#96;</span><br></pre></td></tr></table></figure>


<h2 id="五、创建方便运维的脚本"><a href="#五、创建方便运维的脚本" class="headerlink" title="五、创建方便运维的脚本"></a>五、创建方便运维的脚本</h2><p>一般我们出于对成本的考虑，我们会在一台服务器上装几个节点， 所以一旦集群出现故障，需要重启时，需要分别执行命令去启动几个节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7000&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7001&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7002&#x2F;redis.conf</span><br><span class="line">[root@gdyt-wbredis01 ~]# redis-server  &#x2F;etc&#x2F;redis&#x2F;redis_cluster&#x2F;7003&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

<p>特别是生产故障时，这种做法非常不方便，所以可以自己写个 shell 脚本，<br>方便日后在一台机器上通过一个命令就可以管理这台机器上的所有节点。</p>
<p>编写脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig: 2345 55 25</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description: Redis实例集群服务启动和停止脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">公共参数</span></span><br><span class="line">REDIS_BIN="/usr/local/redis/src/"</span><br><span class="line">LOCAL_IP=`ip addr | grep "inet" | grep  -v "inet6" | awk -F ' ' '&#123;print $2&#125;' | awk -F '/' '&#123;print $1&#125;' | grep -v "127.0.0.1"` #如果IP有多个,需要指定IP</span><br><span class="line">PORT_LIST="7000 7001 7002 7003" #端口需要根据实际情况定义,每个端口使用空格隔开</span><br><span class="line">CONFIG_DIR="/etc/redis/redis_cluster"</span><br><span class="line">PASSWORD="yourpassword"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for port in $PORT_LIST</span><br><span class="line">do</span><br><span class="line">	if [ ! -f "$CONFIG_DIR/$port/redis.conf" ]</span><br><span class="line">	then</span><br><span class="line">		echo "$CONFIG_DIR/$port/redis.conf is not exist!"</span><br><span class="line">		exit 2</span><br><span class="line">	fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export PATH=$REDIS_BIN:$PATH</span><br><span class="line"></span><br><span class="line">function status()&#123;</span><br><span class="line">	for port in $PORT_LIST</span><br><span class="line">	do</span><br><span class="line">		pid=`ps aux |  grep -v grep  | grep "redis-server $LOCAL_IP:$port" | awk -F ' ' '&#123;print $2&#125;'`</span><br><span class="line">		if [ ! -z "$pid" ]</span><br><span class="line">		then</span><br><span class="line">			echo "redis process [$pid] $LOCAL_IP:$port is run.."</span><br><span class="line">		else</span><br><span class="line">			echo "redis process [$pid] $LOCAL_IP:$port not run.."</span><br><span class="line">		fi</span><br><span class="line">	done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function start()&#123;</span><br><span class="line">	for port in $PORT_LIST</span><br><span class="line">	do</span><br><span class="line">		redis-server $CONFIG_DIR/$port/redis.conf </span><br><span class="line">	done</span><br><span class="line">	status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stop()&#123;</span><br><span class="line">	for port in $PORT_LIST</span><br><span class="line">	do</span><br><span class="line">		redis-cli -h $LOCAL_IP -p $port -a $PASSWORD shutdown</span><br><span class="line">	done	</span><br><span class="line">	status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case "$1" in</span><br><span class="line">	start)</span><br><span class="line">		echo "start redis.."</span><br><span class="line">		start</span><br><span class="line">		;;</span><br><span class="line">	stop)</span><br><span class="line">		echo "stop redis.."</span><br><span class="line">		stop</span><br><span class="line">		;;</span><br><span class="line">	status)</span><br><span class="line">		echo "redis status.."</span><br><span class="line">		status</span><br><span class="line">		;;</span><br><span class="line">	restart)</span><br><span class="line">		echo "restart redis.."</span><br><span class="line">		echo "stop redis.."</span><br><span class="line">		stop</span><br><span class="line">		echo "start redis.."</span><br><span class="line">		start</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		echo $"Usage: $0 &#123;start|stop|status|restart&#125;"</span><br><span class="line">		exit 2</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>


<p>注册服务，并设置成开机启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gdyt-wbredis01 init.d]# ls -l &#x2F;etc&#x2F;init.d&#x2F;redis-server</span><br><span class="line">-rwxr-xr-x 1 root root 1506 8月  17 09:47 &#x2F;etc&#x2F;init.d&#x2F;redis-server</span><br><span class="line">[root@gdyt-wbredis01 init.d]# chkconfig --add redis-server</span><br><span class="line">[root@gdyt-wbredis01 init.d]# chkconfig on redis-server</span><br></pre></td></tr></table></figure>


<p><strong>使用脚本进行启动，停止，重启 redis 服务</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server start #启动</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server status #状态</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server stop #停止</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;redis-server restart #重启</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018082408.png" alt=""></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"># Redis</a>
              <a href="/tags/Redis-cluster/" rel="tag"># Redis cluster</a>
              <a href="/tags/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="tag"># Redis集群搭建</a>
              <a href="/tags/redis-trib-rb/" rel="tag"># redis-trib.rb</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/08/30/the-diff-ArrayList-Vector-LinkedList/" rel="prev" title="夯实基础 1：ArrayList、Vector、LinkedList 的区别">
      <i class="fa fa-chevron-left"></i> 夯实基础 1：ArrayList、Vector、LinkedList 的区别
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/08/12/redis-java-client-Jedis/" rel="next" title="Redis 开发与运维 3：Redis 的Java 客户端 Jedis">
      Redis 开发与运维 3：Redis 的Java 客户端 Jedis <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、概述"><span class="nav-number">1.</span> <span class="nav-text">一、概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#节点准备"><span class="nav-number">1.1.</span> <span class="nav-text">节点准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#节点握手"><span class="nav-number">1.2.</span> <span class="nav-text">节点握手</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分配槽"><span class="nav-number">1.3.</span> <span class="nav-text">分配槽</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、用-redis-trib-rb-搭建集群"><span class="nav-number">2.</span> <span class="nav-text">二、用 redis-trib.rb 搭建集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装目录"><span class="nav-number">2.1.</span> <span class="nav-text">安装目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭防火墙"><span class="nav-number">2.2.</span> <span class="nav-text">关闭防火墙</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Redis"><span class="nav-number">2.3.</span> <span class="nav-text">安装Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装-redis-trib-rb-工具"><span class="nav-number">2.4.</span> <span class="nav-text">安装 redis-trib.rb 工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）安装Ruby"><span class="nav-number">2.4.1.</span> <span class="nav-text">1）安装Ruby</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）安装-rubygem-redis-依赖。"><span class="nav-number">2.4.2.</span> <span class="nav-text">2）安装 rubygem redis 依赖。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集群配置"><span class="nav-number">2.5.</span> <span class="nav-text">集群配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）创建集群配置文件夹"><span class="nav-number">2.5.1.</span> <span class="nav-text">1）创建集群配置文件夹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）创建多个实例目录"><span class="nav-number">2.5.2.</span> <span class="nav-text">2）创建多个实例目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3）-配置文件"><span class="nav-number">2.5.3.</span> <span class="nav-text">3） 配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4）用配置文件启动各个节点"><span class="nav-number">2.5.4.</span> <span class="nav-text">4）用配置文件启动各个节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5）配置集群-At-least-6-nodes-are-required-至少需要6个节点"><span class="nav-number">2.5.5.</span> <span class="nav-text">5）配置集群(At least 6 nodes are required., 至少需要6个节点)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6）验证"><span class="nav-number">2.5.6.</span> <span class="nav-text">6）验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、设置密码"><span class="nav-number">3.</span> <span class="nav-text">三、设置密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、优化系统"><span class="nav-number">4.</span> <span class="nav-text">四、优化系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、创建方便运维的脚本"><span class="nav-number">5.</span> <span class="nav-text">五、创建方便运维的脚本</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="crazyfzw"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">crazyfzw</p>
  <div class="site-description" itemprop="description">做个有趣的技术人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">140</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/crazyfzw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;crazyfzw" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://book.douban.com/people/crazyfzw/" title="Booklist → https:&#x2F;&#x2F;book.douban.com&#x2F;people&#x2F;crazyfzw&#x2F;" rel="noopener" target="_blank"><i class="fab fa-skype fa-fw"></i>Booklist</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:crazyfzw@gmail.com" title="E-Mail → mailto:crazyfzw@gmail.com" rel="noopener" target="_blank"><i class="fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/104894167431407693109" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;104894167431407693109" rel="noopener" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/profile.php?id=100011315733045" title="Facebook → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100011315733045" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>Facebook</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3829383159" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3829383159" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://ifeve.com/" title="http:&#x2F;&#x2F;ifeve.com&#x2F;" rel="noopener" target="_blank">并发编程网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.importnew.com/" title="http:&#x2F;&#x2F;www.importnew.com&#x2F;" rel="noopener" target="_blank">ImportNew</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://jm.taobao.org/categories/" title="http:&#x2F;&#x2F;jm.taobao.org&#x2F;categories&#x2F;" rel="noopener" target="_blank">阿里中间件团队博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.ibm.com/developerworks/cn/java/" title="https:&#x2F;&#x2F;www.ibm.com&#x2F;developerworks&#x2F;cn&#x2F;java&#x2F;" rel="noopener" target="_blank">IBM developerworks</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tech.meituan.com/" title="https:&#x2F;&#x2F;tech.meituan.com&#x2F;" rel="noopener" target="_blank">美团点评技术团队</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://calvin1978.blogcn.com/" title="http:&#x2F;&#x2F;calvin1978.blogcn.com&#x2F;" rel="noopener" target="_blank">江南白衣的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://blog.720ui.com/" title="http:&#x2F;&#x2F;blog.720ui.com" rel="noopener" target="_blank">梁桂钊的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.jianshu.com/u/581f548ef0ec" title="https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;581f548ef0ec" rel="noopener" target="_blank">李艳鹏的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://jinnianshilongnian.iteye.com/" title="http:&#x2F;&#x2F;jinnianshilongnian.iteye.com&#x2F;" rel="noopener" target="_blank">张开涛的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/zuoxiaolong" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;zuoxiaolong" rel="noopener" target="_blank">左潇龙的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/xrq730/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;xrq730&#x2F;" rel="noopener" target="_blank">五月的仓颉</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://yikun.github.io/" title="https:&#x2F;&#x2F;yikun.github.io&#x2F;" rel="noopener" target="_blank">Yikun的博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.ruanyifeng.com/" title="http:&#x2F;&#x2F;www.ruanyifeng.com" rel="noopener" target="_blank">阮一峰的个人网站</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">crazyfzw</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">458k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">6:56</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'jyxPxkBMeEmDfMMTuuyBdGdu-gzGzoHsz',
      appKey     : '7SEECyfT4R10oTtj4zDMOdBt',
      placeholder: "ヾﾉ≧∀≦)o 来呀！吐槽一番吧！",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
